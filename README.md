# API Курсов Валют ЦБ РФ (Чистый PHP)

Данный проект предоставляет простой и высокопроизводительный REST API для получения кросс-курсов валют на основе XML-данных Центрального Банка РФ (ЦБ РФ). Проект написан на **чистом PHP 8.2** (без использования тяжелых фреймворков), с применением PostgreSQL, Redis и RabbitMQ для фонового сбора исторических данных.

## Возможности

- Получение и кеширование ежедневных курсов валют с сайта `cbr.ru`.
- Расчет **кросс-курсов** между любыми двумя валютами (например, из USD в EUR).
- Расчет **разницы** с предыдущим торговым днем.
- Асинхронный сбор исторических данных за последние **180 дней** через очередь RabbitMQ и фонового воркера.
- Запуск проекта "из коробки" с помощью Docker Compose.

## Требования

- Docker и Docker Compose

## Запуск приложения

1. Склонируйте репозиторий и перейдите в корень проекта.
2. Соберите и запустите Docker-контейнеры:
   ```bash
   docker-compose up -d --build
   ```
   _Приложение автоматически установит PHP зависимости (через Composer), создаст файл `.env` из примера и применит миграции базы данных при запуске контейнера._

## Использование

### 1. API Эндпоинт

Чтобы получить кросс-курс на определенную дату, выполните `GET` запрос к `/api/v1/rates`:

```bash
curl "http://localhost:8083/api/v1/rates?date=2023-10-25&base=USD&quote=RUB"
```

**Ответ:**

```json
{
  "symbol": "USDEUR",
  "rate": 0.9452,
  "date": "2023-10-25",
  "rate_prev": 0.9467,
  "date_prev": "2023-10-24",
  "difference": -0.0015
}
```

- `date`: Формат `YYYY-MM-DD`.
- `base`: 3-х символьный код базовой валюты (например, `USD`).
- `quote`: (Опционально) 3-х символьный код валюты котировки. По умолчанию `RUR`.

### 2. Сбор исторических данных (за 180 дней)

Для демонстрации интеграции с брокером сообщений (RabbitMQ), вы можете отправить задачи в очередь для получения и сохранения курсов за последние 180 дней.

```bash
docker-compose exec php-fpm php bin/console.php fetch-history
```

Эта команда быстро отправляет 180 сообщений в RabbitMQ. Фоновый воркер (работающий в контейнере `php-worker`) асинхронно обрабатывает эти сообщения и заполняет базу данных PostgreSQL.

Вы можете отслеживать прогресс воркера с помощью команды:

```bash
docker-compose logs -f php-worker
```

## Ключевые особенности архитектуры

- **Чистая архитектура без фреймворков**: Весь код эффективно структурирован с использованием пространств имен и автозагрузки PSR-4 (Composer).
- **Отказоустойчивость и Кеширование**: API сначала пытается прочитать данные из Redis, затем из БД, и только в случае необходимости обращается (с "падением" на прямые HTTP запросы) к API ЦБ РФ напрямую "на лету".
- **Готовность к микросервисам**: Скрипт воркера (`bin/worker.php`) работает независимо от основного веб-приложения, что позволяет легко его масштабировать.
